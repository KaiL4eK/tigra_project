<?xml version="1.0" ?>
<robot name="tigra" xmlns:xacro="http://www.ros.org/wiki/xacro">

<xacro:property name="wheel_width" value="0.25" />
<xacro:property name="wheel_radius" value="0.25" />
<xacro:property name="wheel_mass" value="20" />

<xacro:property name="wheel_turn_limit" value="${pi/4}"/>
<xacro:property name="degrees_30" value="${pi/6}"/>
<xacro:property name="mid_wheel_turn_limit" value="${degrees_30}"/>

<xacro:property name="springStiffness" value="125000" />
<xacro:property name="springReference" value="0" />

<!-- XACRO INERTIA -->
<xacro:macro name="null_inertial">
    <inertial>
      <mass value="1.0"/>
      <inertia ixx="0.01" ixy="0" ixz="0"
               iyy="0.01" iyz="0"
               izz="0.01"/>
    </inertial>
</xacro:macro>

<xacro:macro name="wheel_inertial"
               params="r h mass *origin">
    <inertial>
      <xacro:insert_block name="origin"/>
      <mass value="${mass}"/>
      <inertia ixx="${mass / 12 * (3 * r * r + h * h)}" ixy="0.0" ixz="0.0"
               iyy="${mass / 12 * (3 * r * r + h * h)}" iyz="0.0"
               izz="${mass / 2 * r * r}" />
    </inertial> 
</xacro:macro>

<!-- XACRO WHEEL -->
<xacro:macro name="wheels" params="name">
    <link name="${name}">
      <visual>
        <origin xyz="0 0 0" rpy="${pi/2} 0 0" />
        <geometry>
          <cylinder length="${wheel_width}" radius="${wheel_radius}"/>
        </geometry>
      </visual>
      <collision>
        <origin xyz="0 0 0" rpy="${pi/2} 0 0" />
        <geometry>
          <cylinder length="${wheel_width}" radius="${wheel_radius}"/>
        </geometry>
      </collision>
      <xacro:wheel_inertial
          r="${wheel_radius}" h="${wheel_width}"
          mass="${wheel_mass}" >
	  <origin xyz="0 0 0" rpy="${pi/2} 0 0" />
      </xacro:wheel_inertial>
    </link>
</xacro:macro>

<!-- XACRO SPEED -->
<xacro:macro name="speed_wheel" params="name base_name xyz ">
    <xacro:wheels name="wheel_${name}" />

    <gazebo reference="${name}_spring_joint">
    	<implicitSpringDamper>true</implicitSpringDamper>
    	<springStiffness>${springStiffness}</springStiffness>
    	<springReference>${springReference}</springReference>
    </gazebo>

    <joint name="${name}_spring_joint" type="prismatic">
    <limit lower="-0.1" upper="0.1" effort="0" velocity="0"/> 
      <parent link="${base_name}"/>
      <child link="spring1_${name}"/>
	  <dynamics damping="0.0" friction="0.0"/>
	  <axis xyz="0 0 1"/>
    </joint>

    <link name="spring1_${name}">
      <xacro:null_inertial/>
    </link>   

    <joint name="${name}_speed_joint" type="continuous">
      <parent link="spring1_${name}"/> 
      <child link="wheel_${name}"/>
      <origin xyz="${xyz}" rpy="0 0 0"/>
      <axis xyz="0 1 0"/>
      <limit effort="500.0" velocity="10.0" />
    </joint>
</xacro:macro>

<!-- XACRO STEER -->
<xacro:macro name="steer_wheel" params="name base_name xyz">
    <xacro:wheels name="wheel_${name}" />
 
    <gazebo reference="${name}_spring_joint">
    	<implicitSpringDamper>true</implicitSpringDamper>
    	<springStiffness>${springStiffness}</springStiffness>
    	<springReference>${springReference}</springReference>
    </gazebo>
    
    <joint name="${name}_spring_joint" type="prismatic">
    <limit lower="-0.1" upper="0.1" effort="0" velocity="0"/>
      <parent link="${base_name}"/>
      <child link="spring2_${name}"/>
	  <dynamics damping="0.0" friction="0.0"/>
	  <axis xyz="0 0 1"/>
    </joint>
   
    <link name="spring2_${name}">
      <xacro:null_inertial/>
    </link>
    
    <joint name="${name}_steer_joint" type="revolute">
      <limit lower="${-wheel_turn_limit}"
             upper="${wheel_turn_limit}"
             effort="1000" velocity="0"/>
      <parent link="spring2_${name}"/>
      <child link="steer_${name}"/>
      <origin xyz="${xyz}" rpy="0 0 0"/>
      <axis xyz="0 0 1"/>
    </joint>

     <link name="steer_${name}">
      <xacro:null_inertial/>
    </link>
    
    <joint name="${name}_speed_joint" type="continuous">
      <parent link="steer_${name}"/>
      <child link="wheel_${name}"/>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <axis xyz="0 1 0"/>
      <limit effort="500" velocity="10.0" />
    </joint>
</xacro:macro>

</robot>
